#!/bin/bash

. "${BASH_SOURCE%/*}/funcs.sh" "$1"

check() {
    FILE="$1"
    MIN="$2"
    MAX="$3"

    if [ -z $MAX  ]
    then
        MAX=$MIN
    fi

    SIZE=$(stat -c %s "$DIRNAME/$FILE")
    echo "File: $FILE"
    if [ $MIN -eq $MAX ]
    then
        echo "Size: $SIZE (expected $MIN)"
    else
        echo "Size: $SIZE (expected $MIN...$MAX)"
    fi

    if [ $SIZE -ge $MIN -a $SIZE -le $MAX ]
    then
        echo "Pass"
    else
        echo "FAIL!"
        exit 1
    fi
}

# Ensure log contains file sizes, predicted and actual
cat "$DIRNAME/obama.$DESTTYPE" > /dev/null
cat "$DIRNAME/raven.$DESTTYPE" > /dev/null

if [ "$DESTTYPE" == "mp4" ];
then
    # mp4
    check "obama.mp4" 99151 113048
    check "raven.mp4" 133661 137986
elif [ "$DESTTYPE" == "mp3" ];
then
    # mp3
    check "obama.mp3" 107101
    check "raven.mp3" 126456
elif [ "$DESTTYPE" == "wav" ];
then
    # wav
    check "obama.wav" 1058636
    check "raven.wav" 3699406
elif [ "$DESTTYPE" == "ogg" ];
then
    # ogg
    check "obama.ogg" 66181
    check "raven.ogg" 141211
else
echo "Internal error, unknown type $DESTTYPE. Fix script!"
exit 99
fi
